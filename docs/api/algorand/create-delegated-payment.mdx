# CreateDelegatedPayment

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Request Parameters

| Name | Type | Description |
| ---- | ---- | ----------- | 
| assetId         | `string` | The ID of the DeCash asset that is being sent. |
| sender.address  | `string` | The address of the account that is sending the funds. Note that this account must have enough funds to cover both the amount that is being sent, and the [fee](#CreateDelegatedPayment). |
| sender.amount   | `number` | The amount that is being sent. |
| receiver        | `string` | The address of the account that is receiving the funds. Note that, if this account is not a [DelegatedWallet](#CreateDelegatedPayment), then it must be opted into the token that is being sent. | 



## Responses

### Regular response

| Name | Type | Description |
| ---- | ---- | ----------- | 
| noSign | `string[]` | The array of transactions (in msgpack) that shall not be signed. Together with toSign it composes the full array of transactions in the group. |
| toSign | `string[]` | The array of transactions (in msgpack) that must be signed with the spending key of the `sender` account. Together with the noSign transactions it composes the full array of transactions in the group. |
| info.fee | `number` | Amount of DeCash that is being spent on fees in this transaction. | 

### Validation rerors

Returned when the parameters are invalid

| Name | Content | 
| ---- | ------- | 
| Status code | 400 |
| errorId | `INVALID_PARAMS` |
| message | `Validation errors in CreateDelegatedPayment request.` | 
| errors | Array of strings containing additional informations |


### Sender not opted in 

Returned when the sender has not yet opted into the token that is being sent.

| Name | Content | 
| ---- | ------- | 
| Status code | 400 |
| errorId | `SENDER_NOT_OPTED_IN` |
| message | `Sender must opt in to the asset before sending funds.` | 

### Sender not enough funds

Returned when the sender does not have enough funds to pay both the transfer of the funds and the fee.

| Name | Content |
| ---- | ------- |
| Status code | 400 |
| errorId | `SENDER_NOT_ENOUGH_FUNDS` |
| message | `Sender does not have enough funds to send the requested amount.` |

### Receiver not opted in

Returned when a user is sending funds to a non-[DelegatedWallet](#CreateDelegatedPayment) account that has not yet opted into the token that is being sent.

| Name | Content |
| ---- | ------- |
| Status code | 400 |
| errorId | `RECEIVER_NOT_OPTED_IN` |
| message | `Receiver must opt in to the asset before receiving funds.` |



## Example Usage

<Tabs>
<TabItem value="js" label="JavaScript">

```js
const response = await fetch('https://api.decash.com/CreateDelegatedPayment', {
  method: 'POST',
  body: JSON.stringify({
    assetId: 'usd',
    sender: {
      address: 'DUIUUAOHRAUHVE5GXDE6OURUFWVXXFNSCOK3IMGWCZWSAASSM342O4YMAY',
      amount: 14.50,
    },
    receiver: 'CNIOPGMZ3OSZLPEO7POGMVUEQVDV2RT3G4MSKGHRBX2SOPOEIOGBIFIMVQ',
  })
});
const data = await response.json();

```

</TabItem>
</Tabs>

## Example Success Response

```json
{
  "noSign": ["iqNhbXTOAAMNQKNmZWXND6CiZnbOARq8HqNnZW6sdGVzdG5ldC12MS4womdoxCBIY7UYpLPITsgQ8i1PEIHLD3HwWaesIN7GL39w5Qk6IqNncnDEINiYMg4zFOLDjNerIPaxDIAcHhwOCGtftTZmF1PUxRzSomx2zgEawAajcmN2xCCJZZGRCVyrMfyFvsxeVLYvYG5hdipXoAQLRYjmhvjjJqNzbmTEIOFCRKufkeV8Sz20fmzi1S0BI6tryNDZqb/HW3vtf2fkpHR5cGWjcGF5","iaRhcmN2xCCJZZGRCVyrMfyFvsxeVLYvYG5hdipXoAQLRYjmhvjjJqJmds4BGrweo2dlbqx0ZXN0bmV0LXYxLjCiZ2jEIEhjtRiks8hOyBDyLU8QgcsPcfBZp6wg3sYvf3DlCToio2dycMQg2JgyDjMU4sOM16sg9rEMgBweHA4Ia1+1NmYXU9TFHNKibHbOARrABqNzbmTEIIllkZEJXKsx/IW+zF5Uti9gbmF2KlegBAtFiOaG+OMmpHR5cGWlYXhmZXKkeGFpZM4DGUVQ"],
  "toSign": ["iqRhYW10AaRhcmN2xCDhQkSrn5HlfEs9tH5s4tUtASOra8jQ2am/x1t77X9n5KJmds4BGrweo2dlbqx0ZXN0bmV0LXYxLjCiZ2jEIEhjtRiks8hOyBDyLU8QgcsPcfBZp6wg3sYvf3DlCToio2dycMQg2JgyDjMU4sOM16sg9rEMgBweHA4Ia1+1NmYXU9TFHNKibHbOARrABqNzbmTEIAZekVF1hNOHnM9lYgORVqhWh57VRV/Cwtzz71pasQgJpHR5cGWlYXhmZXKkeGFpZM4DGUVQ","iqRhYW10CqRhcmN2xCCJZZGRCVyrMfyFvsxeVLYvYG5hdipXoAQLRYjmhvjjJqJmds4BGrweo2dlbqx0ZXN0bmV0LXYxLjCiZ2jEIEhjtRiks8hOyBDyLU8QgcsPcfBZp6wg3sYvf3DlCToio2dycMQg2JgyDjMU4sOM16sg9rEMgBweHA4Ia1+1NmYXU9TFHNKibHbOARrABqNzbmTEIAZekVF1hNOHnM9lYgORVqhWh57VRV/Cwtzz71pasQgJpHR5cGWlYXhmZXKkeGFpZM4DGUVQ"],
  "info": {
      "asaFee": 0.01
  }
}
```
